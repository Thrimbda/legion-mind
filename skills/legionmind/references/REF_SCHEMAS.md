# LegionMind æ•°æ®ç»“æ„

> **èŒƒå›´**: å®šä¹‰ç›®å½•ç»“æ„ã€Planã€Contextã€Tasksã€Configã€Ledger å’Œ Review è¯­æ³•ã€‚

---

## 1. ç›®å½•ç»“æ„

```text
.legion/
â”œâ”€â”€ config.json          # å…¨å±€çŠ¶æ€ä¸ä»»åŠ¡æ³¨å†Œè¡¨
â”œâ”€â”€ ledger.csv           # æ‰€æœ‰æ“ä½œçš„å®¡è®¡æ—¥å¿—
â”œâ”€â”€ playbook.md          # è·¨ä»»åŠ¡æ²‰æ·€ï¼ˆæ¨èï¼‰
â””â”€â”€ tasks/{task-id}/     # ä»»åŠ¡çº§äº§ç‰©
    â”œâ”€â”€ plan.md          # ä»»åŠ¡ç›®æ ‡ä¸è®¾è®¡ç´¢å¼•
    â”œâ”€â”€ context.md       # è¿›å±•æ—¥å¿—ä¸äº¤æ¥æ–‡æ¡£
    â”œâ”€â”€ tasks.md         # ç»“æ„åŒ–ä»»åŠ¡æ¸…å•
    â”œâ”€â”€ config.json      # ä»»åŠ¡çº§é…ç½®ï¼ˆæ¨èï¼Œå« Scope ç»“æ„ï¼‰
    â”œâ”€â”€ docs/            # è®¾è®¡/è¯„å®¡/æŠ¥å‘Šï¼ˆæ¨èï¼‰
    â”‚   â”œâ”€â”€ task-brief.md
    â”‚   â”œâ”€â”€ research.md              # RFC Heavyï¼šè¯æ®é©±åŠ¨ç°çŠ¶æ‘¸åº•ï¼ˆæ¨è/å¼ºåˆ¶ï¼‰
    â”‚   â”œâ”€â”€ rfc.md
    â”‚   â”œâ”€â”€ review-rfc.md
    â”‚   â”œâ”€â”€ review-code.md
    â”‚   â”œâ”€â”€ review-security.md
    â”‚   â”œâ”€â”€ implementation-plan.md   # å¯é€‰ï¼šä» RFC Milestones æŠ½å–
    â”‚   â”œâ”€â”€ risk-register.md         # å¯é€‰ï¼šé£é™©ç™»è®°ä¸å›æ»šè§¦å‘å™¨
    â”‚   â”œâ”€â”€ appendix-migration.md    # å¯é€‰ï¼šè¿ç§»ç»†èŠ‚é™„å½•ï¼ˆé¿å… RFC ä¸»æ–‡è†¨èƒ€ï¼‰
    â”‚   â”œâ”€â”€ appendix-threat-model.md # å¯é€‰ï¼šå¨èƒæ¨¡å‹é™„å½•
    â”‚   â”œâ”€â”€ test-report.md
    â”‚   â”œâ”€â”€ report-walkthrough.md
    â”‚   â””â”€â”€ pr-body.md
    â””â”€â”€ reports/         # å¯é€‰ï¼šbenchmarkã€profilingã€æˆªå›¾ç­‰
```

---

## 2. plan.md (ä»»åŠ¡è®¡åˆ’ä¸ç´¢å¼•)

**ç›®çš„**: å®šä¹‰â€œåšä»€ä¹ˆâ€ (Goal) å’Œâ€œä¸ºä»€ä¹ˆâ€ (Why)ã€‚ä½œä¸ºè¯¦ç»†è®¾è®¡ (RFC) çš„ç´¢å¼•ã€‚
**è§’è‰²**: è¯»å¤šå†™å°‘ (ä¸»è¦ä¾› Reviewer å®¡é˜…ï¼Œåˆ›å»ºåå°‘å˜åŠ¨)ã€‚

### ç»“æ„

```markdown
# {Task Name}

## ç›®æ ‡
(ä¸€å¥è¯æè¿°ç›®æ ‡)

## è¦ç‚¹
- **å…³é”®è¯1**: æè¿°
- **å…³é”®è¯2**: æè¿°

## èŒƒå›´ (Scope)
- `src/auth/` - è®¤è¯é€»è¾‘
- `docs/rfc.md` - è®¾è®¡æ–‡æ¡£

## è®¾è®¡ç´¢å¼• (Design Index)
> **Design Source of Truth**: [RFC é“¾æ¥æˆ–å¤–éƒ¨æ–‡æ¡£]

**æ‘˜è¦**:
- æ ¸å¿ƒæµç¨‹: (1-2 å¥è¯)
- éªŒè¯ç­–ç•¥: (1-2 å¥è¯)

## é˜¶æ®µæ¦‚è§ˆ
1. **Phase 1** - æè¿°
2. **Phase 2** - æè¿°

---
*Created: YYYY-MM-DD | Updated: YYYY-MM-DD*
```

### æ ¡éªŒè§„åˆ™
- **æ ‡é¢˜å¿…é¡»ä¿ç•™**: ä¸ºäº†å…¼å®¹ MCPï¼Œå¿…é¡»ä¿ç•™ `## ç›®æ ‡`ã€`## è¦ç‚¹`ã€`## èŒƒå›´`ã€`## é˜¶æ®µæ¦‚è§ˆ` è¿™å‡ ä¸ªäºŒçº§æ ‡é¢˜ã€‚
- **è®¾è®¡å†…å®¹**: ä¸æ—§ç‰ˆä¸åŒï¼Œè¯¦ç»†çš„è®¾è®¡ï¼ˆæ¥å£ã€æµç¨‹å›¾ï¼‰**åº”è¯¥**æ”¾åœ¨ RFC ä¸­ã€‚æ­¤æ–‡ä»¶ä»…æä¾›é“¾æ¥å’Œç®€è¦æ‘˜è¦ã€‚

---


---

## 2.5 docs/task-brief.md (é—®é¢˜å®šä¹‰ä¸éªŒæ”¶)

**ç›®çš„**ï¼šç”¨æœ€å°‘ä¿¡æ¯å›ºå®šâ€œé—®é¢˜æ˜¯ä»€ä¹ˆ / ä¸ºä»€ä¹ˆ / æ€ä¹ˆéªŒæ”¶ / å“ªäº›å‡è®¾â€ï¼Œé˜²æ­¢åç»­ Agent åå¤è°ƒæŸ¥ã€é‡å¤æé—®å’Œä¸Šä¸‹æ–‡æ±¡æŸ“ã€‚  
**è§’è‰²**ï¼šè¯»å¤šå†™å°‘ï¼ˆå¯ä»¥åœ¨å‘ç°æ–°ä¿¡æ¯æ—¶å°å¹…ä¿®è®¢ï¼Œä½†è¦åœ¨ `context.md` è®°å½•å˜æ›´åŸå› ï¼‰ã€‚

### ç»“æ„ï¼ˆæ¨èï¼‰

```markdown
# Task Brief

## Problem Statement
(ç”¨ 3-8 å¥è¯æè¿°ï¼šç°è±¡ã€æœŸæœ›ã€å½±å“èŒƒå›´ã€å¤ç°æ¡ä»¶)

## Acceptance Criteria
- [ ] (å¯éªŒè¯çš„éªŒæ”¶æ¡ä»¶ 1)
- [ ] (å¯éªŒè¯çš„éªŒæ”¶æ¡ä»¶ 2)

## Constraints
- (çº¦æŸï¼šå…¼å®¹æ€§ã€æ€§èƒ½ã€å®‰å…¨ã€ä¾èµ–ã€éƒ¨ç½²ç­‰)

## Assumptions
- (ä½ åšäº†å“ªäº›é»˜è®¤å‡è®¾ï¼Ÿå“ªäº›ä¿¡æ¯ç¼ºå¤±ä½†ä½ å…ˆæŒ‰æŸç§æ–¹å¼å¤„ç†ï¼Ÿ)

## Non-Goals
- (æ˜ç¡®ä¸åšä»€ä¹ˆï¼Œé¿å… scope creep)

## Risks
- (æ½œåœ¨é£é™©ç‚¹ + å›æ»š/ç¼“è§£æ–¹å¼)

## Verification Plan
- Commands:
  - `...`
- Expected:
  - (é¢„æœŸç°è±¡/è¾“å‡º)
- Manual checks (å¦‚éœ€è¦):
  - ...

## References
- (issue/PR é“¾æ¥ã€å…³é”®æ–‡ä»¶è·¯å¾„ã€ç›¸å…³ ADR/RFC é“¾æ¥)
```

### è§„åˆ™
- ä¸è¦ç²˜è´´å¤§æ®µä»£ç ï¼›ç”¨æ–‡ä»¶è·¯å¾„/è¡Œå·æˆ–ç®€è¦ç‰‡æ®µå¼•ç”¨å³å¯ã€‚
- å¦‚æœå’Œ RFC é‡å¤ï¼Œä¿ç•™ task-brief çš„â€œé—®é¢˜å®šä¹‰ + éªŒæ”¶ + å‡è®¾â€ï¼Œå…¶ä½™ç»†èŠ‚æ”¾ RFCã€‚


---

## 2.6 docs/research.mdï¼ˆç°çŠ¶æ‘¸åº•ï¼ŒRFC Heavy æ¨è/å¼ºåˆ¶ï¼‰

**ç›®çš„**ï¼šæŠŠâ€œç°åœ¨æ˜¯ä»€ä¹ˆæ · / å†å²å†³ç­–æ˜¯ä»€ä¹ˆ / å…³é”®å‘æ˜¯ä»€ä¹ˆâ€ç”¨è¯æ®é©±åŠ¨çš„æ–¹å¼å¿«é€Ÿå†™æ¸…ï¼Œé¿å…åç»­å®ç°é˜¶æ®µé‡å¤è°ƒç ”ã€é‡å¤é˜…è¯»ä¸é‡å¤æ¨ç†ã€‚  
**è§’è‰²**ï¼šè¯»å¤šå†™å°‘ï¼ˆè®¾è®¡é˜¶æ®µå¯è¿­ä»£æ›´æ–°ï¼Œä½†åº”ä¿æŒç®€çŸ­ï¼‰ã€‚

### ç»“æ„ï¼ˆæ¨èï¼‰
å‚è€ƒæ¨¡æ¿ï¼š`.opencode/skills/legionmind/references/TEMPLATE_RESEARCH.md`

æ ¸å¿ƒåŸåˆ™ï¼š
- ä¸è¦ç²˜è´´å¤§æ®µä»£ç 
- ä½¿ç”¨æ–‡ä»¶è·¯å¾„ + è¡Œå·/å‡½æ•°åä½œä¸º Evidence
- å¯¹â€œä¸ç¡®å®šç»“è®ºâ€æ˜ç¡®æ ‡æ³¨ `Unverified`

---

## 2.7 docs/rfc.mdï¼ˆè®¾è®¡æ–¹æ¡ˆï¼‰

**ç›®çš„**ï¼šè®¾è®¡ source of truthï¼›ä¾› review ä¸å®ç°é˜¶æ®µå¼•ç”¨ã€‚  
**è§’è‰²**ï¼šä¸­é¢‘æ›´æ–°ï¼ˆè¢« `review-rfc` é©±åŠ¨æ”¶æ•›ï¼‰ã€‚

### RFC æ¡£ä½
- `standard`ï¼šé€‚ç”¨äº Medium é£é™©ä»»åŠ¡ï¼ˆå¯çŸ­ï¼Œä½†å¿…é¡»å« Options/Decision/Verificationï¼‰
- `heavy`ï¼šé€‚ç”¨äº Epic/High-riskï¼ˆå¿…é¡»å« Milestonesã€Migration/Rollbackã€Observability ç­‰ï¼‰

Heavy æ¨¡æ¿å‚è€ƒï¼š
- `.opencode/skills/legionmind/references/TEMPLATE_RFC_HEAVY.md`

---

## 2.8 docs/implementation-plan.mdï¼ˆå¯é€‰ï¼‰

**ç›®çš„**ï¼šæŠŠ RFC çš„ Milestones æŠ½å–æˆæ›´â€œå·¥ç¨‹åŒ–â€çš„æ‰§è¡Œæ¸…å•ï¼Œä¾¿äº tasks.md æ›´æ–°ä¸åˆ†é˜¶æ®µäº¤ä»˜ã€‚  
**è§’è‰²**ï¼šå¯é€‰ï¼›å¯¹ Epic ä»»åŠ¡å¼ºçƒˆå»ºè®®ã€‚

æ¨¡æ¿å‚è€ƒï¼š
- `.opencode/skills/legionmind/references/TEMPLATE_IMPLEMENTATION_PLAN.md`

---

## 2.9 docs/risk-register.md / appendix-*.mdï¼ˆå¯é€‰ï¼‰

**risk-register.md**
- è®°å½•é£é™©ã€è§¦å‘å™¨ã€ç¼“è§£æ–¹å¼ã€å›æ»šè·¯å¾„
- å¯¹ High-risk/Epic ä»»åŠ¡å»ºè®®æœ‰ï¼ˆä½†ä¸æ˜¯å¼ºåˆ¶ï¼‰

**appendix-*.md**
- ç”¨äºæ‰¿è½½æ˜“è†¨èƒ€ç»†èŠ‚ï¼ˆè¿ç§»æ­¥éª¤ã€å¨èƒæ¨¡å‹ã€benchmark è¾“å‡ºç­‰ï¼‰
- ç›®æ ‡ï¼šé¿å… RFC ä¸»æ–‡æˆä¸ºé•¿ä½œæ–‡ï¼ŒåŒæ—¶ä¿ç•™å¯è¿½æº¯è¯æ®

## 3. context.md (ä¸Šä¸‹æ–‡ä¸äº¤æ¥)

**ç›®çš„**: è¿½è¸ªâ€œæ€ä¹ˆåšçš„â€ (How) å’Œâ€œè¿›å±•å¦‚ä½•â€ (Where)ã€‚ä»»åŠ¡çš„æ´»ä½“è®°å¿†ã€‚
**è§’è‰²**: ä»…è¿½åŠ  (Append-only)ï¼Œé«˜é¢‘æ›´æ–°ã€‚

### ç»“æ„

```markdown
# {Task Name} - Context

## ä¼šè¯è¿›å±• (YYYY-MM-DD)
### âœ… å·²å®Œæˆ
- å®Œæˆäº‹é¡¹ 1
### ğŸŸ¡ è¿›è¡Œä¸­
- å½“å‰äº‹é¡¹
### âš ï¸ é˜»å¡/å¾…å®š
- é˜»å¡é¡¹ 1

---

## å…³é”®æ–‡ä»¶
**`path/to/file`** [status]
- ä½œç”¨: ...

## å…³é”®å†³ç­–
| å†³ç­– | åŸå›  | æ›¿ä»£æ–¹æ¡ˆ | æ—¥æœŸ |
|------|------|----------|------|
| ä½¿ç”¨ X | æ€§èƒ½æ›´å¥½ | ä½¿ç”¨ Y | 2023-01-01 |

---

## å¿«é€Ÿäº¤æ¥
**ä¸‹æ¬¡ç»§ç»­ä»è¿™é‡Œå¼€å§‹ï¼š**
1. ä¸‹ä¸€æ­¥éª¤ 1

**æ³¨æ„äº‹é¡¹ï¼š**
- æ³¨æ„äº‹é¡¹ 1

---
*Updated: YYYY-MM-DD HH:mm*
```

---

## 4. tasks.md (ä»»åŠ¡æ¸…å•)

**ç›®çš„**: è¿½è¸ªâ€œçŠ¶æ€â€ (Status)ã€‚æœºå™¨å¯è¯»çš„è¿›åº¦è¡¨ã€‚
**è§’è‰²**: é€šè¿‡ MCP é«˜é¢‘æ›´æ–°ã€‚

### ç»“æ„

```markdown
# {Task Name} - ä»»åŠ¡æ¸…å•

## å¿«é€Ÿæ¢å¤
**å½“å‰é˜¶æ®µ**: Phase 1
**å½“å‰ä»»åŠ¡**: Task 1
**è¿›åº¦**: 1/10 ä»»åŠ¡å®Œæˆ

---

## é˜¶æ®µ 1: Phase Name ğŸŸ¡ IN PROGRESS
- [x] å·²å®Œæˆä»»åŠ¡ | éªŒæ”¶: æ ‡å‡†
- [ ] å½“å‰ä»»åŠ¡ | éªŒæ”¶: æ ‡å‡† â† CURRENT
- [ ] å¾…åŠä»»åŠ¡ | éªŒæ”¶: æ ‡å‡†
```

### é˜¶æ®µçŠ¶æ€é€»è¾‘
- â³ **NOT STARTED**: 0 ä¸ªä»»åŠ¡å®Œæˆã€‚
- ğŸŸ¡ **IN PROGRESS**: å®Œæˆäº† >0 ä¸ªï¼Œä½†æœªå…¨éƒ¨å®Œæˆã€‚
- âœ… **COMPLETE**: æ‰€æœ‰ä»»åŠ¡å‡å·²å®Œæˆã€‚

---

## 5. Review è¯­æ³•

Reviewer å¯ä»¥åœ¨ä¸‰ä¸ªæ–‡ä»¶çš„ä»»æ„ä½ç½®æ’å…¥ Review å—ã€‚

### è§¦å‘æ ¼å¼
```markdown
> [REVIEW] è¯„è®ºå†…å®¹...
> [REVIEW:blocking] å¿…é¡»ä¿®å¤æ­¤é—®é¢˜...
> [REVIEW:question] ä¸ºä»€ä¹ˆé€‰ X?
> [REVIEW:suggestion] å»ºè®®å°è¯• Y...
```

### å“åº”æ ¼å¼ (ç”± MCP è‡ªåŠ¨ç”Ÿæˆ)
```markdown
> [REVIEW] è¯„è®ºå†…å®¹...
> [RESPONSE] å›å¤å†…å®¹...
> [STATUS:resolved]
```

### çŠ¶æ€
- `open`: ç­‰å¾…å›å¤ã€‚
- `resolved`: å·²ä¿®å¤/å·²å›ç­”ã€‚
- `wontfix`: æ‹’ç»ä¿®æ”¹ï¼ˆé™„ç†ç”±ï¼‰ã€‚
- `need-info`: éœ€è¦æ›´å¤šä¿¡æ¯ã€‚

---

## 6. tasks/<task-id>/config.json (ä»»åŠ¡çº§é…ç½®ï¼Œæ¨è)

**ç›®çš„**: æä¾›æœºå™¨å¯æ ¡éªŒçš„ Scopeï¼Œé¿å…â€œè‡ªç„¶è¯­è¨€èŒƒå›´â€éš¾ä»¥çº¦æŸã€‚

### ç¤ºä¾‹
```json
{
  "scope": {
    "allow": ["src/auth/**", "src/utils/*.ts"],
    "deny": ["infra/**", "**/*.sql"]
  }
}
```

### è§„åˆ™
- `allow` / `deny` ä½¿ç”¨ Globï¼ˆä¸å¸¸ç”¨ gitignore/minimatch è¯­ä¹‰ä¸€è‡´ï¼‰ã€‚
- `deny` ä¼˜å…ˆçº§æœ€é«˜ï¼šåŒ¹é… `deny` å³è§†ä¸ºè¶Šç•Œã€‚
- è‹¥å­˜åœ¨ `allow`ï¼Œåˆ™æ‰€æœ‰æ”¹åŠ¨å¿…é¡»å‘½ä¸­ `allow` ä¸”ä¸å‘½ä¸­ `deny`ã€‚
- è‹¥ç¼ºå¤± `config.json`ï¼Œå…è®¸å›é€€åˆ° `plan.md` çš„ Scope åˆ—è¡¨ï¼ˆå¼±çº¦æŸï¼‰ã€‚

---

## 7. docs/ ä¸ reports/ çº¦å®šï¼ˆæ¨èï¼‰

---

## 6. docs/ ä¸ reports/ çº¦å®šï¼ˆæ¨èï¼‰

**ç›®çš„**: ç»Ÿä¸€æ–‡æ¡£è¾“å‡ºä½ç½®ï¼Œä¾¿äº orchestrator ä¸å­ agent è¯»å–/å†™å…¥ã€‚

### è®¾è®¡ä¸å®¡æŸ¥çš„é»˜è®¤è·¯å¾„
- **RFC çœŸæºè·¯å¾„**: `.legion/tasks/<task-id>/docs/rfc.md`
- **RFC å®¡æŸ¥**: `.legion/tasks/<task-id>/docs/review-rfc.md`
- **Code Review**: `.legion/tasks/<task-id>/docs/review-code.md`
- **Security Review**: `.legion/tasks/<task-id>/docs/review-security.md`
- **Walkthrough**: `.legion/tasks/<task-id>/docs/report-walkthrough.md`
- **PR Body**: `.legion/tasks/<task-id>/docs/pr-body.md`

### æŠ¥å‘Š/é™„ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰
- æ€§èƒ½/åŸºå‡†: `.legion/tasks/<task-id>/reports/benchmark.md`
- Profiling: `.legion/tasks/<task-id>/reports/profiling.md`
- æˆªå›¾/åª’ä½“: `.legion/tasks/<task-id>/reports/`

### ä¸ handoff / dashboard çš„å…³ç³»
- `docs/` ä¸‹çš„æ–‡ä»¶åº”åœ¨ `context.md` çš„â€œå…³é”®æ–‡ä»¶â€é‡Œç™»è®°ï¼ˆä¾¿äºäº¤æ¥ï¼‰ã€‚
- `report-walkthrough.md` ä¸ `pr-body.md` å¯ä½œä¸º dashboard çš„é‡ç‚¹é“¾æ¥ã€‚

---

## 8. playbook.mdï¼ˆè·¨ä»»åŠ¡æ²‰æ·€ï¼Œæ¨èï¼‰

**ç›®çš„**: å°†å¯å¤ç”¨æ¨¡å¼/ç­–ç•¥ä»å•ä¸€ä»»åŠ¡ä¸­æŠ½ç¦»ï¼Œå½¢æˆé•¿æœŸçŸ¥è¯†èµ„äº§ã€‚

**å»ºè®®ç»“æ„**:
```markdown
# Legion Playbook

## æ¨¡å¼ï¼š...
- æ¥æºä»»åŠ¡ï¼štask-xxx
- èƒŒæ™¯ï¼š...
- æ–¹æ¡ˆï¼š...
- é€‚ç”¨è¾¹ç•Œï¼š...
- é™·é˜±ï¼š...
- æœ€å°ç¤ºä¾‹ï¼š...
```
